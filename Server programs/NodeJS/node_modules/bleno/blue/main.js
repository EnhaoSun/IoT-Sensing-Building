var util = require('util');

//
// require bleno peripheral library.
//
var bleno = require('..');

//
// The BLE Service
//
var BlueService = require('./blue-service');

//
//A name to advertise Blue service.
//
var name = 'pi';
var blueService = new BlueService();


//
//Wait until the BLE radio powers on before attempting to advertise.
//

bleno.on('stateChange', function(state){

    console.log('on -> stateChange: ' + state);

    if(state == 'poweredOn'){
        bleno.startAdvertising(name, [blueService.uuid], function(err){
            if(err){
                console.log(err);
            }
        });
    }else{
        bleno.stopAdvertising();
    }
});

bleno.on('advertisingStart', function(error){
    if(!error){
        console.log('on -> advertisingStart: ' + (error ? 'error' + error : 'success'));
        bleno.setServices([
            blueService
        ]);
    }
});


// connect and disconnect events ///
bleno.on('accept', function(clientAddress) {
  console.log('on -> accept, client: ' + clientAddress);
  bleno.updateRssi();
});

bleno.on('disconnect', function(clientAddress) {
  console.log('on -> disconnect, client: ' + clientAddress);
});

bleno.on('rssiUpdate', function(rssi) {
  console.log('on -> rssiUpdate: ' + rssi);
});

bleno.on('mtuChange', function(mtu){
    console.log('on -> mtuChange' + mtu);
});

bleno.on('serviceSet', function(error){
    console.log('on -> servicesSet: ' + (error ? 'error ' + error : 'success'));
});
